# SQL 概念


## 约束


### 主键

- 每行都具有一个主键值，任意两行的主键值都不相同
- 包含主键值的列从不修改或更新（部分 `DMBS` 允许这样做，但是还是别做的好）
- 主键值不能重用，如果从表中删除某一行，其主键值不分配给新行
- 主键允许定义多个列，有顺序关系


### 外键

- 外键是表中的一列，其值必须列在另一表的主键中
- 外键有助防止意外删除


### 唯一约束

- 表可包含多个唯一约束，但每个表只允许一个主键
- 唯一约束列可包含NULL值
- 唯一约束列可修改或更新
- 唯一约束列的值可重复使用
- 与主键不一样，唯一约束不能用来定义外键


### 检查约束

插入和更新都会限制


## 索引

索引用来排序数据以加快搜索和排序操作的速度

- 允许指定多个列作为索引，这时列的顺序很重要，如果与查询使用不匹配索引就发挥不了作用，而且其他方面带来负面开销
- 索引改善检索操作的性能，但降低了数据插入、修改和删除的性能（因为每次更新表数据时都会动态更新索引）
- 索引数据可能要占用大量的存储空间
- 取值不多的数据（如州）不如具有更多可能值的数据（如姓或名），能通过索引得到那么多的好处
- 索引用于数据过滤和数据排序。如果你经常以某种特定的顺序排序数据，则该数据可能适合做索引


## 视图

视图是虚拟的表。与包含数据的表不一样，视图只包含使用时动态检索数据的查询。

视图提供了一种封装SELECT语句的层次，可用来简化数据处理，重新格式化或保护基础数据


### 使用场景

- 重用SQL语句（创建不绑定特定数据的视图是一种好办法）
- 简化复杂的SQL操作；在编写查询后，可以方便地重用它而不必知道其基本查询细节
- 使用表的一部分而不是整个表
- 保护数据；可以授予用户访问表的特定部分的权限，而不是整个表的访问权限
- 更改数据格式和表示；视图可返回与底层表的表示和格式不同的数据
- 用视图过滤不想要的数据


### 规则和限制

- 视图可以嵌套，即可以利用从其他视图中检索数据的查询来构造视图
- 许多DBMS禁止在视图查询中使用 `ORDER BY` 子句
- 有些DBMS要求对返回的所有列进行命名，如果列是计算字段，则需要使用别名
- 视图不能索引，也不能有关联的触发器或默认值
- 有些DBMS把视图作为只读的查询，这表示可以从视图检索数据，但不能将数据写回底层表
- 有些DBMS允许创建这样的视图，它不能进行导致行不再属于视图的插入或更新

!!! warning
    因为视图不包含数据，所以每次使用视图时，都必须处理查询执行时需要的所有检索。如果你用多个联结和过滤创建了复杂的视图或者嵌套了视图，性能可能会下降得很厉害